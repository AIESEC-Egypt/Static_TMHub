<!doctype html>
<html lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-176442644-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-176442644-2');
</script>

        <meta charset="utf-8">
        <title id="course_header_title">PRIME</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Site Description Here">
        <link rel="shortcut icon" type="image/png" href="img/favicon.png">
        <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/stack-interface.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/socicon.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/lightbox.min.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/flickity.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/iconsmind.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/jquery.steps.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/theme.css" rel="stylesheet" type="text/css" media="all" />
        <link href="css/custom.css" rel="stylesheet" type="text/css" media="all" />
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:200,300,400,400i,500,600,700%7CMerriweather:300,300i" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    </head>
    <body class=" ">
        <a id="start"></a>
        <div class="nav-container ">
            <div class="bar bar--sm visible-xs">
                <div class="container">
                    <div class="row">
                        <div class="col-3 col-md-2">
                            <a href="home.html">
                                <img class="logo logo-dark" alt="logo" src="img/logo-dark.png" />
                                <img class="logo logo-light" alt="logo" src="img/logo-light.png" />
                            </a>
                        </div>
                        <div class="col-9 col-md-10 text-right">
                            <a href="#" class="hamburger-toggle" data-toggle-class="#menu1;hidden-xs">
                                <i class="icon icon--sm stack-interface stack-menu"></i>
                            </a>
                        </div>
                    </div>
                    <!--end of row-->
                </div>
                <!--end of container-->
            </div>
            <!--end bar-->
            <nav id="menu1" class="bar bar--sm bar-1 hidden-xs " >
                <div class="container">
                    <div class="row">
                        <div class="col-lg-1 col-md-2 hidden-xs">
                            <div class="bar__module">
                                <a href="home.html">
                                    <img class="logo logo-dark" alt="logo" src="img/logo-light.png" />
                                    <img class="logo logo-light" alt="logo" src="img/logo-light.png" />
                                </a>
                            </div>
                            <!--end module-->
                        </div>
                        <div class="col-lg-11 col-md-12 text-right text-left-xs text-left-sm">
                            <div class="bar__module">
                                <ul class="menu-horizontal text-right">
                                    
                                    <li>
                                        <a href="index.html">Home</a>
                                        <!--end dropdown container-->
                                    </li>
                                    <li>
                                        <a href="home.html#courses">Courses</a>
                                        <!--end dropdown container-->
                                    </li>
                                    <li>
                                        <a href="mycourses.html">My Courses</a>
                                        <!--end dropdown container-->
                                    </li>
                                    <li>
                                        <a>Hello</a> <span id="user_name"></span> , <a href="#" onclick="logout();">Logout</a>
                                    </li>
                                
                                </ul>
                            </div>
                            <!--end module-->
                            
                            <!--end module-->
                        </div>
                    </div>
                    <!--end of row-->
                </div>
                <!--end of container-->
            </nav>
            <!--end bar-->
        </div>
        
        
        <div class="main-container">
            <section class="imagebg image--light cover cover-blocks bg--secondary " data-overlay="3">
                <div id="course_cover" class="background-image-holder" >
                    <img id="course_poster" alt="background" src="" />
                </div>
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 col-lg-5 " data-overlay="1">
                            
                            <div >
                                <h5 style="color: white;">Categories > <span id="course_category"></span></h5>
                                <h1 id="course_title"  style="color: white;"></h1>
                                <h7 id="course_description" class="lead" style="color: white;">
                                    
                                </h7>
                                <hr class="short">
                                <p style="color: white;">
                                    Course Added: <span id="course_creation"></span>
                                    
                                </p>
                                <a id="enroll_btn" class="btn btn--sm btn--primary type--uppercase" style="background-color: #ffc845;display: none;" href="#" onclick="enroll();">
                                    <span class="btn__text" style="color: black;">
                                        Enroll
                                    </span>
                                </a>
                                <br />
                            </div>
                        </div>
                    </div>
                    <!--end of row-->
                </div>
                <!--end of container-->
            </section>
            <section class="switchable switchable--switch">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="boxed boxed--border  bg--secondary boxed--lg box-shadow">
                                <h5>Course Content</h5>
                                <span id="mats_container"></span>
                                
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div id="progess_tab" class="boxed boxed--border  bg--secondary boxed--lg box-shadow" style="display: none;">
                                <h5>Course Progress</h5>
                                <div class="text-center"><span id="radial_container"></span></div>
                                
                                
                            </div>
                        </div>
                    </div>
                    <!--end row-->
                </div>
                <!--end of container-->
            </section>
            
            
            
            
            
            
            
            <!--end of tabs container-->
            <footer class="footer-3 text-center-xs space--xs ">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <img alt="Image" class="logo" src="img/logo-dark.png" />
                            
                        </div>
                        <div class="col-md-6 text-right text-center-xs">
                            <ul class="social-list list-inline list--hover">
                                
                                <li class="list-inline-item">
                                    <a href="https://www.facebook.com/membercommitteegypt/">
                                        <i class="socicon socicon-facebook icon icon--xs"></i>
                                    </a>
                                </li>
                                <li class="list-inline-item">
                                    <a href="https://www.instagram.com/mcegyptt/">
                                        <i class="socicon socicon-instagram icon icon--xs"></i>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <!--end of row-->
                    <div class="row">
                        <div class="col-md-6">
                            <p class="type--fine-print">
                                
                            </p>
                        </div>
                        <div class="col-md-6 text-right text-center-xs">
                            <span class="type--fine-print">&copy;
                                <span class="update-year"></span> AIESEC in Egypt</span>
                            
                        </div>
                    </div>
                    <!--end of row-->
                </div>
                <!--end of container-->
            </footer>
        </div>
        
        <div id="mats_modal" class="modal-container" data-modal-index="1">
             <div class="modal-content section-modal">
                <section class="unpad ">
                    <div class="container">

                        <div class="row justify-content-center">
                            <div class="col-md-12 col-12">

                                <div class="feature feature-1">

                                    <div class="feature__body boxed boxed--sm boxed--border">
                                        <div class="modal-close modal-close-cross"></div>
                                        <table style="margin-bottom: 0px; margin-top: 0px;"><tr><td width="80%"><p style="margin-bottom: 0px; margin-top: 0px;" id="mats_title"></p></td><td width="20%">
                                            <button id="complete_btn" type="submit" onclick="" class="btn btn--primary type--uppercase">Mark As Complete</button>
                                            </td></tr></table>
                                                




                                    </div>
                                    
                                    <iframe id="mat_frame" src="" width="640" height="480"></iframe>
                                    
                                </div>
                                                               
                            </div>
                        </div>
                                                       
                    </div>
                                                    
                </section>
            </div>
            </div>
        <!--<div class="loader"></div>-->
        <a class="back-to-top inner-link" href="#start" data-scroll-class="100vh:active">
            <i class="stack-interface stack-up-open-big"></i>
        </a>
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/flickity.min.js"></script>
        <script src="js/easypiechart.min.js"></script>
        <script src="js/parallax.js"></script>
        <script src="js/typed.min.js"></script>
        <script src="js/datepicker.js"></script>
        <script src="js/isotope.min.js"></script>
        <script src="js/ytplayer.min.js"></script>
        <script src="js/lightbox.min.js"></script>
        <script src="js/granim.min.js"></script>
        <script src="js/jquery.steps.min.js"></script>
        <script src="js/countdown.min.js"></script>
        <script src="js/twitterfetcher.min.js"></script>
        <script src="js/spectragram.min.js"></script>
        <script src="js/smooth-scroll.min.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/radialIndicator.js"></script>
        <script>
            var endpoint = "https://edm.aiesec.org.eg"
            function getUrlVars() {
                    var vars = {};
                    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                        vars[key] = value;
                    });
                    return vars;
                }

            function getUrlParam(parameter, defaultvalue){
                    var urlparameter = defaultvalue;
                    if(window.location.href.indexOf(parameter) > -1){
                        urlparameter = getUrlVars()[parameter];
                        }
                    return urlparameter;
                }

            function listCookies() {
                var theCookies = document.cookie.split(';');
                var aString = '';
                for (var i = 1 ; i <= theCookies.length; i++) {
                    aString += i + ' ' + theCookies[i-1] + "\n";
                }
                return aString;
            }
            
            function getCookie(cname) {
              var name = cname + "=";
              var decodedCookie = decodeURIComponent(document.cookie);
              var ca = decodedCookie.split(';');
              for(var i = 0; i <ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                  c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                  return c.substring(name.length, c.length);
                }
              }
              return "";
            }

            function setCookie(cname, cvalue, exdays) {
              var d = new Date();
              d.setTime(d.getTime() + (exdays*24*60*60*1000));
              var expires = "expires="+ d.toUTCString();
              document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
            }    
            
            function show_course(data){
                document.getElementById('course_category').innerHTML = data['data']['getCourse']['category']['edges'][0]['node']['title'];
                document.getElementById('course_title').innerHTML = data['data']['getCourse']['title'];
                document.getElementById('course_header_title').innerHTML = data['data']['getCourse']['title'];
                document.getElementById('course_description').innerHTML = "";
                document.getElementById('course_creation').innerHTML = data['data']['getCourse']['createdAt'].split('T')[0];
                document.getElementById('course_poster').setAttribute('src', 'img/upload/'+data['data']['getCourse']['poster']);
                document.getElementById('course_cover').setAttribute('style', 'background: url(img/upload/'+ data['data']['getCourse']['poster']+'); opacity: 1;');
                
                var materials = data['data']['getCourse']['material']['edges'];
                    materials.forEach(function(element) {
                        if(element['node']['videoContent'] != null){
                            var $log = $( "#mats_container" ),
                            str = '<div class="boxed boxed--border  bg--secondary boxed--sm box-shadow"><table><tr><td width="10&"><i class="icon--sm icon-Video"></i></td><td width="60%">'+ element['node']['videoContent']['title']+'</td><td width="20%">'+ element['node']['duration']+' mins</td><td width="10%"></td></tr></table></div>',
                            html = $.parseHTML( str ),
                            nodeNames = [];
                            $log.append( html );
                        }
                        else if(element['node']['documentContent'] != null){
                            var $log = $( "#mats_container" ),
                            str = '<div class="boxed boxed--border  bg--secondary boxed--sm box-shadow"><table><tr><td width="10&"><i class="icon--sm icon-File"></i></td><td width="60%">'+ element['node']['documentContent']['title']+'</td><td width="20%">'+ element['node']['duration']+' mins</td><td width="10%"></td></tr></table></div>',
                            html = $.parseHTML( str ),
                            nodeNames = [];
                            $log.append( html );
                        }
                    });
            }
            
            
            function load_course(course_id){
                var query = `query Myquery($id: ID!){
                  getCourse(id:$id){
                    id
                    title
                    category{edges{node{id title}}}
                    createdAt
                    poster
                    material{
                          edges{
                            node{
                              id
                              videoContent{
                                id
                                title
                              }
                              documentContent{
                                id
                                title
                              }
                              duration
                            }
                          }
                        }
                    }
                }`;
                
                var variables = { id: course_id },

                data_ = fetch(endpoint + '/graphql', {
                  method: 'POST',
                  headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                  },
                  body: JSON.stringify({
                    query,
                    variables,
                  })
                })
                  .then(r => r.json())
                  .then(data => show_course(data));
                //console.log(opp_id);
                
            }
            
            
            function show_user_data(data){
                document.getElementById('user_name').innerHTML = data['data']['CurrentUser']['profile']['firstName'];

            }
            function get_current_user(access_token){
                var query = `query Myquery {
                     CurrentUser
                      {
                        id
                        profile
                        {
                          firstName
                        }
                      }
                    }`;

                    data_ = fetch(endpoint + '/graphql', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'JWT ' + access_token,
                      },
                      body: JSON.stringify({
                        query,
                      })
                    })
                      .then(r => r.json())
                      .then(data => show_user_data(data));
            }
            function logout(){
                document.cookie = "edm_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                window.location.href = '/index.html';
            }
            
            function verify_complete_mat(data){
                location.reload();
            }
            function complete_mat(progress_id){
                var course_id = getUrlParam("id", "");
                var current_token = getCookie('edm_token');
                var query = `mutation MyMutation($courseId: ID!, $enrollmentProgressId: ID!) {
                      completeMaterial(enrollmentProgressId:$enrollmentProgressId, courseId:$courseId){
                        progress{
                          isDone
                        }
                      }
                    }`;
                var variables = { courseId: course_id,  enrollmentProgressId:progress_id},
                    data_ = fetch(endpoint + '/graphql', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'JWT ' + current_token,
                      },
                      body: JSON.stringify({
                        query,
                        variables
                      })
                    })
                      .then(r => r.json())
                      .then(data => verify_complete_mat(data));
            }
            function show_enroll_data(data){
                if(data['data']['enrollStudent']['enrollment'] != null){
                    location.reload();
                }
            }
            function enroll(){
                var current_token = getCookie('edm_token');
                var course_id = getUrlParam("id", "");
                var query = `mutation MyMutation($courseId: ID!) {
                      enrollStudent(courseId:$courseId){
                        enrollment{
                          id
                        }
                      }
                    }`;
                var variables = { courseId: course_id },
                    data_ = fetch(endpoint + '/graphql', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'JWT ' + current_token,
                      },
                      body: JSON.stringify({
                        query,
                        variables
                      })
                    })
                      .then(r => r.json())
                      .then(data => show_enroll_data(data));
            }
            function load_mats(progress_id, mat_type, mat_link, file_title, isDone){
                console.log(progress_id);
                console.log(mat_type);
                console.log(mat_link);
                if(mat_type == "video"){
                    document.getElementById('mats_title').innerHTML = '<i class="icon--sm icon-Video"></i>'+ file_title;
                }
                else if(mat_type == "file"){
                    document.getElementById('mats_title').innerHTML = '<i class="icon--sm icon-File"></i>'+ file_title;
                }
                if (isDone){
                    document.getElementById('complete_btn').setAttribute("onclick", "");
                    document.getElementById('complete_btn').innerHTML = "Completed"
                    document.getElementById('complete_btn').setAttribute("class","btn btn-success type--uppercase")
                }
                else{
                    document.getElementById('complete_btn').setAttribute("onclick", "complete_mat('"+progress_id+"');");
                    document.getElementById('complete_btn').innerHTML = "Mark As Complete!"
                    document.getElementById('complete_btn').setAttribute("class","btn btn--primary type--uppercase")
                }
                //document.getElementById('complete_btn').setAttribute("onclick", "complete_mat('"+progress_id+"');");
                document.getElementById('mat_frame').setAttribute('src', 'https://drive.google.com/file/d/'+mat_link+'/preview');
                document.getElementById('mat_frame').setAttribute('data-src', 'https://drive.google.com/file/d/'+mat_link+'/preview');
                document.getElementById('mats_modal').setAttribute('class', 'modal-container modal-active');
            }
            function verify_enrollment(data){
                if (data['data']['MyEnrollment'] != null){
                    
                    document.getElementById('course_category').innerHTML = data['data']['MyEnrollment']['course']['category']['edges'][0]['node']['title'];
                    document.getElementById('course_title').innerHTML = data['data']['MyEnrollment']['course']['title'];
                    document.getElementById('course_header_title').innerHTML = data['data']['MyEnrollment']['course']['title'];
                    document.getElementById('course_description').innerHTML = data['data']['MyEnrollment']['course']['description'];
                    document.getElementById('course_creation').innerHTML = data['data']['MyEnrollment']['course']['createdAt'].split('T')[0];
                    document.getElementById('course_poster').setAttribute('src', 'img/upload/'+data['data']['MyEnrollment']['course']['poster']);
                    document.getElementById('course_cover').setAttribute('style', 'background: url(img/upload/'+ data['data']['MyEnrollment']['course']['poster']+'); opacity: 1;');
                    
                    var radialObj = radialIndicator('#radial_container', {
                        barColor : {
                            0: '#FF0000',
                            33: '#FFFF00',
                            66: '#0066FF',
                            100: '#33CC33'
                        },
                        barWidth : 10,
                        percentage: true,
                        initValue : 0
                    }); 
                    radialObj.animate(data['data']['MyEnrollment']['totalProgress']);
                    
                    //document.getElementById('radial_container').innerHTML = '<div class="radial" data-value="90" data-timing="1000" data-color="#4a90e2" data-size="200" data-bar-width="10"><span class="h3 radial__label">90%</span></div>'
                    /*document.getElementById('course_radial_progress').style.display = "none"
                    document.getElementById('course_progress').innerHTML = data['data']['MyEnrollment']['totalProgress'].toString() +'%';
                    document.getElementById('course_radial_progress').setAttribute('data-value', data['data']['MyEnrollment']['totalProgress'].toString())
                    document.getElementById('course_radial_progress').style.display = "block"  */                                                                                        
                    var materials = data['data']['MyEnrollment']['courseProgress']['edges'];
                    materials.forEach(function(element) {
                        if(element['node']['material']['videoContent'] != null){
                            var file_id = element['node']['material']['videoContent']['youtubeId'].split('/')[5];
                            var file_title = element['node']['material']['videoContent']['title'];
                            var file_complete = element['node']['isDone'];
                            var file_status = "Not Completed";
                            if (file_complete){
                                file_status = "Completed"
                            }
                            else{
                                file_status = "Not Completed"
                            }
                            var $log = $( "#mats_container" ),
                            str = '<div class="boxed boxed--border  bg--secondary boxed--sm box-shadow"><table><tr><td width="10&"><i class="icon--sm icon-Video"></i></td><td width="60%"><a href="javascript:void(0);" onclick="load_mats(' + "'" +element['node']['id']+ "'" + ',' + "'" + "video" + "'" +  ', ' + "'" +file_id + "'"+  ', ' + "'" +file_title + "'" +', '+file_complete+');">'+ element['node']['material']['videoContent']['title']+'</a></td><td width="20%">'+ element['node']['material']['duration']+' mins</td><td width="10%">'+file_status+'</td></tr></table></div>',
                            html = $.parseHTML( str ),
                            nodeNames = [];
                            $log.append( html );
                        }
                        else if(element['node']['material']['documentContent'] != null){
                            var file_id = element['node']['material']['documentContent']['url'].split('/')[5];
                            var file_title = element['node']['material']['documentContent']['title'];
                            var file_complete = element['node']['isDone'];
                            var file_status = "Not Completed";
                            if (file_complete){
                                file_status = "Completed"
                            }
                            else{
                                file_status = "Not Completed"
                            }
                            var $log = $( "#mats_container" ),
                            str = '<div class="boxed boxed--border  bg--secondary boxed--sm box-shadow"><table><tr><td width="10&"><i class="icon--sm icon-File"></i></td><td width="60%"><a href="javascript:void(0);" onclick="load_mats(' + "'" +element['node']['id']+ "'" + ',' + "'" + "file" + "'" +  ', ' + "'" +file_id + "'"+  ', ' + "'" +file_title + "'" +', '+file_complete+');">'+ element['node']['material']['documentContent']['title']+'</a></td><td width="20%">'+ element['node']['material']['duration']+' mins</td><td width="10%">'+file_status+'</td></tr></table></div>',
                            html = $.parseHTML( str ),
                            nodeNames = [];
                            $log.append( html );
                        }
                    });
                    document.getElementById('progess_tab').style.display = 'block';
                }
                else{
                    document.getElementById('enroll_btn').style.display = 'Block';
                    var course_id = getUrlParam("id", "");
                    load_course(course_id);
                }
            }
            function fetch_user_enrollment(){
                var access_token = getCookie('edm_token');
                var query = `query Myquery($courseId: ID!) {
                     MyEnrollment(courseId:$courseId){
                        courseProgress{
                          edges{
                          node{
                            id
                            material{
                              videoContent{
                                id
                                title
                                youtubeId
                              }
                              documentContent{
                                id
                                title
                                url
                              }
                              duration
                            }
                            isDone
                          }
                        }}
                        totalProgress
                        joinedAt
                        course{
                          id
                          title
                          poster
                          category{edges{node{id title}}}
                          createdAt
                          description
                        }
                      }
                    }`;
                    
                variables = {courseId: getUrlParam("id", "")}
                    data_ = fetch(endpoint + '/graphql', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        'Authorization': 'JWT ' + access_token,
                      },
                      body: JSON.stringify({
                        query,
                        variables
                      })
                    })
                      .then(r => r.json())
                      .then(data => verify_enrollment(data));
            }
            
            
            function main(){
                
               var current_token = getCookie('edm_token');
                if (current_token == "")
                {
                    window.location.href = '/index.html';
                }
                else
                {
                    get_current_user(current_token)
                }
                
                //var course_id = getUrlParam("id", "");
                //load_course(course_id);
                fetch_user_enrollment();
                

            }
            window.onload = main;
        </script>
    </body>
</html>